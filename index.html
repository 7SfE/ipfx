<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>网络设备安全分析报告系统 v2.7.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <div>
                    <h1>网络设备安全分析报告系统 v2.7.2</h1>
                    <p>网络安全监测与风险评估平台 | 增强品牌识别 | 批量重复处理 | 固定编辑索引</p>
                </div>
            </div>
            <div class="status-indicator">
                <div class="status-item">
                    <span class="status-value" id="online-count">0</span>
                    <span class="status-label">在线设备</span>
                </div>
                <div class="status-item">
                    <span class="status-value" id="offline-count">0</span>
                    <span class="status-label">离线设备</span>
                </div>
                <div class="status-item">
                    <span class="status-value" id="domestic-percent">0%</span>
                    <span class="status-label">国产化率</span>
                </div>
            </div>
        </header>
        
        <section class="upload-section">
            <div class="upload-area">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>上传网络扫描文件</h3>
                <p>支持多种格式：设备状态CSV、端口扫描CSV、HTML报告、XML数据。系统将自动解析并分析网络设备安全状况。</p>
                <p><strong>增强功能：</strong>固定编辑索引 | 批量重复处理 | 增强品牌识别 | 无风险降级</p>
                <div class="upload-buttons">
                    <button class="btn btn-primary" id="uploadDeviceFileBtn">
                        <i class="fas fa-upload"></i> 上传设备CSV
                    </button>
                    <button class="btn btn-primary" id="uploadScanFileBtn">
                        <i class="fas fa-upload"></i> 上传端口CSV
                    </button>
                    <button class="btn btn-primary" id="addSingleDeviceBtn">
                        <i class="fas fa-plus-circle"></i> 添加单条设备
                    </button>
                    <button class="btn btn-info" id="detectBrandsBtn">
                        <i class="fas fa-search"></i> 识别设备品牌
                    </button>
                    <div class="export-dropdown">
                        <button class="btn btn-success">
                            <i class="fas fa-file-export"></i> 导出安全报告
                        </button>
                        <div class="export-dropdown-content">
                            <a href="#" id="exportHtmlBtn"><i class="fas fa-file-code"></i> 导出HTML报告</a>
                            <a href="#" id="exportDocBtn"><i class="fas fa-file-word"></i> 导出DOC报告</a>
                            <a href="#" id="exportDataBtn"><i class="fas fa-file-export"></i> 导出原始数据</a>
                        </div>
                    </div>
                    <button class="btn btn-warning" id="importDataBtn">
                        <i class="fas fa-file-import"></i> 导入数据
                    </button>
                    <button class="btn btn-danger" id="clearDataBtn">
                        <i class="fas fa-trash-alt"></i> 清除全部数据
                    </button>
                </div>
                <input type="file" id="deviceFileInput" accept=".csv,.txt" style="display: none;">
                <input type="file" id="scanFileInput" accept=".csv,.txt" style="display: none;">
                <input type="file" id="importFileInput" accept=".json,.html,.xml" style="display: none;">
            </div>
        </section>
        
        <section class="dashboard">
            <div class="dashboard-card">
                <h3>设备状态统计 <button class="btn btn-secondary btn-small" id="showOnlineStatsBtn"><i class="fas fa-chart-bar"></i> 查看详情</button></h3>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-card">
                <h3>安全风险分布 <button class="btn btn-secondary btn-small" id="showRiskStatsBtn"><i class="fas fa-exclamation-triangle"></i> 查看详情</button></h3>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-card">
                <h3>设备类型分布 <button class="btn btn-secondary btn-small" id="showDeviceTypesBtn"><i class="fas fa-network-wired"></i> 查看详情</button></h3>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="deviceTypeChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-card">
                <h3>国产设备比例 <button class="btn btn-secondary btn-small" id="showDomesticStatsBtn"><i class="fas fa-flag"></i> 查看详情</button></h3>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="domesticChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="device-table-section">
            <div class="table-header">
                <h3><i class="fas fa-list"></i> 设备列表</h3>
                <div class="filter-container">
                    <input type="text" id="searchInput" placeholder="搜索设备..." class="form-control" style="width: 200px;">
                    <select id="statusFilter" class="filter-select">
                        <option value="">所有状态</option>
                        <option value="在线">在线</option>
                        <option value="离线">离线</option>
                        <option value="未知">未知</option>
                    </select>
                    <select id="deviceTypeFilter" class="filter-select">
                        <option value="">所有类型</option>
                        <option value="计算机">计算机</option>
                        <option value="打印机">打印机</option>
                        <option value="路由器">路由器</option>
                        <option value="交换机">交换机</option>
                        <option value="服务器">服务器</option>
                        <option value="其他">其他</option>
                    </select>
                    <select id="domesticFilter" class="filter-select">
                        <option value="">国产/非国产</option>
                        <option value="国产">国产</option>
                        <option value="非国产">非国产</option>
                    </select>
                    <select id="riskFilter" class="filter-select">
                        <option value="">所有风险</option>
                        <option value="高风险">高风险</option>
                        <option value="中风险">中风险</option>
                        <option value="低风险">低风险</option>
                        <option value="无风险">无风险</option>
                    </select>
                    <button class="btn btn-secondary" id="refreshBtn"><i class="fas fa-sync-alt"></i> 刷新</button>
                </div>
            </div>
            <div class="table-container">
                <table id="deviceTable">
                    <thead>
                        <tr>
                            <th>状态</th>
                            <th>设备名称</th>
                            <th>IP地址</th>
                            <th>设备类型</th>
                            <th>MAC地址</th>
                            <th>国产标识</th>
                            <th>开放服务</th>
                            <th>安全风险</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="deviceTableBody">
                        <!-- 数据将通过JS动态加载 -->
                    </tbody>
                </table>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #34a853;"></div>
                    <span>在线设备</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ea4335;"></div>
                    <span>离线设备</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e8f5e9;"></div>
                    <span>国产设备</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fce4ec;"></div>
                    <span>非国产设备</span>
                </div>
            </div>
        </section>
        
        <footer>
            <p>© 2025 网络安全分析系统 | 维护人员: msyg | 数据更新时间: <span id="updateTime"></span> | 版本: <span id="version">2.7.0</span></p>
            <p class="responsive-info" id="responsiveInfo"></p>
        </footer>
    </div>
    
    <!-- 编辑设备信息模态框 -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> 编辑设备信息</h3>
                <button class="close-btn" id="closeEditModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <div class="form-group">
                        <label for="editName">设备名称 <span class="required">*</span></label>
                        <input type="text" id="editName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editIp">IP地址 <span class="required">*</span></label>
                        <input type="text" id="editIp" class="form-control" required pattern="^(\d{1,3}\.){3}\d{1,3}$">
                        <small class="form-text">格式: 192.168.1.1</small>
                    </div>
                    <div class="form-group">
                        <label for="editType">设备类型 <span class="required">*</span></label>
                        <select id="editType" class="form-control" required>
                            <option value="">请选择类型</option>
                            <option value="计算机">计算机</option>
                            <option value="打印机">打印机</option>
                            <option value="路由器">路由器</option>
                            <option value="交换机">交换机</option>
                            <option value="服务器">服务器</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editMac">MAC地址 <span class="required">*</span></label>
                        <input type="text" id="editMac" class="form-control" required pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$">
                        <small class="form-text">格式: 00:1A:2B:3C:4D:5E</small>
                    </div>
                    <div class="form-group">
                        <label for="editDomestic">国产标识 <span class="required">*</span></label>
                        <select id="editDomestic" class="form-control" required>
                            <option value="">请选择</option>
                            <option value="是">是</option>
                            <option value="否">否</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editStatus">状态 <span class="required">*</span></label>
                        <select id="editStatus" class="form-control" required>
                            <option value="">请选择状态</option>
                            <option value="在线">在线</option>
                            <option value="离线">离线</option>
                            <option value="未知">未知</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editServices">开放服务（用逗号分隔）</label>
                        <input type="text" id="editServices" class="form-control" placeholder="例如: HTTP(80), FTP(21), SSH(22)">
                    </div>
                    <div class="form-group">
                        <label for="editRisk">安全风险 <span class="required">*</span></label>
                        <select id="editRisk" class="form-control" required>
                            <option value="">请选择风险等级</option>
                            <option value="高风险">高风险</option>
                            <option value="中风险">中风险</option>
                            <option value="低风险">低风险</option>
                            <option value="无风险">无风险</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editNotes">备注</label>
                        <textarea id="editNotes" class="form-control" rows="3"></textarea>
                    </div>
                    <input type="hidden" id="editIndex">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditBtn">取消</button>
                <button class="btn btn-primary" id="saveEditBtn">保存更改</button>
            </div>
        </div>
    </div>
    
    <!-- 添加设备模态框 -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> 添加新设备</h3>
                <button class="close-btn" id="closeAddModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addForm">
                    <div class="form-group">
                        <label for="addName">设备名称 <span class="required">*</span></label>
                        <input type="text" id="addName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="addIp">IP地址 <span class="required">*</span></label>
                        <input type="text" id="addIp" class="form-control" required pattern="^(\d{1,3}\.){3}\d{1,3}$">
                        <small class="form-text">格式: 192.168.1.1</small>
                    </div>
                    <div class="form-group">
                        <label for="addType">设备类型 <span class="required">*</span></label>
                        <select id="addType" class="form-control" required>
                            <option value="">请选择类型</option>
                            <option value="计算机">计算机</option>
                            <option value="打印机">打印机</option>
                            <option value="路由器">路由器</option>
                            <option value="交换机">交换机</option>
                            <option value="服务器">服务器</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addMac">MAC地址 <span class="required">*</span></label>
                        <input type="text" id="addMac" class="form-control" required pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$">
                        <small class="form-text">格式: 00:1A:2B:3C:4D:5E</small>
                    </div>
                    <div class="form-group">
                        <label for="addDomestic">国产标识 <span class="required">*</span></label>
                        <select id="addDomestic" class="form-control" required>
                            <option value="">请选择</option>
                            <option value="是">是</option>
                            <option value="否">否</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addStatus">状态 <span class="required">*</span></label>
                        <select id="addStatus" class="form-control" required>
                            <option value="">请选择状态</option>
                            <option value="在线">在线</option>
                            <option value="离线">离线</option>
                            <option value="未知">未知</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addServices">开放服务（用逗号分隔）</label>
                        <input type="text" id="addServices" class="form-control" placeholder="例如: HTTP(80), FTP(21), SSH(22)">
                    </div>
                    <div class="form-group">
                        <label for="addRisk">安全风险 <span class="required">*</span></label>
                        <select id="addRisk" class="form-control" required>
                            <option value="">请选择风险等级</option>
                            <option value="高风险">高风险</option>
                            <option value="中风险">中风险</option>
                            <option value="低风险">低风险</option>
                            <option value="无风险">无风险</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addNotes">备注</label>
                        <textarea id="addNotes" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddBtn">取消</button>
                <button class="btn btn-success" id="confirmAddBtn">添加设备</button>
            </div>
        </div>
    </div>
    
    <!-- 统计详情模态框 -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="statsTitle"></h3>
                <button class="close-btn" id="closeStatsModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="statsContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeStatsBtn">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 导入数据模态框 -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-import"></i> 导入数据</h3>
                <button class="close-btn" id="closeImportModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>请上传之前从本系统导出的JSON格式数据文件：</p>
                <input type="file" id="importFileInputModal" accept=".json" class="form-control" onchange="previewImportData(event)">
                <div id="importPreview" style="margin-top: 20px; display: none;">
                    <h4>数据预览</h4>
                    <pre id="importDataPreview" style="background-color: #f5f5f5; padding: 15px; border-radius: 6px; max-height: 200px; overflow-y: auto; font-size: 12px;"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelImportBtn">取消</button>
                <button class="btn btn-primary" id="confirmImportBtn">导入数据</button>
            </div>
        </div>
    </div>
    
    <!-- 确认清除数据模态框 -->
    <div id="confirmClearModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> 确认清除数据</h3>
                <button class="close-btn" id="closeConfirmClearModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-trash-alt" style="font-size: 4rem; color: #ea4335; margin-bottom: 20px;"></i>
                    <h3 style="color: #ea4335; margin-bottom: 15px;">警告：此操作不可撤销！</h3>
                    <p style="margin-bottom: 10px;">您确定要清除所有数据吗？这将删除：</p>
                    <ul style="text-align: left; margin-left: 30px; margin-bottom: 20px;">
                        <li>所有已加载的设备数据</li>
                        <li>所有扫描数据</li>
                        <li>所有图表统计数据</li>
                        <li>本地存储中的所有数据</li>
                    </ul>
                    <p style="color: #666; font-size: 0.9rem;">建议在清除前先导出数据备份。</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelClearBtn">取消</button>
                <button class="btn btn-danger" id="confirmClearBtn">确认清除全部数据</button>
            </div>
        </div>
    </div>
    
    <!-- 批量重复处理确认模态框 -->
    <div id="batchDuplicateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-circle"></i> 发现重复数据（批量处理）</h3>
                <button class="close-btn" id="closeBatchDuplicateModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="batchDuplicateContent">
                    <!-- 动态内容 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="skipAllDuplicatesBtn">跳过所有</button>
                <button class="btn btn-primary" id="overwriteAllDuplicatesBtn">覆盖所有</button>
                <button class="btn btn-warning" id="addAllDuplicatesBtn">新增所有</button>
            </div>
        </div>
    </div>
    
    <!-- 确认删除模态框 -->
    <div id="confirmDeleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> 确认删除设备</h3>
                <button class="close-btn" id="closeConfirmDeleteModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-trash-alt" style="font-size: 3rem; color: #ea4335; margin-bottom: 15px;"></i>
                    <h4 id="deleteDeviceName" style="margin-bottom: 10px;"></h4>
                    <p style="margin-bottom: 15px;">您确定要删除此设备吗？此操作不可撤销。</p>
                    <div id="deleteDeviceInfo" style="text-align: left; background-color: #f5f5f5; padding: 10px; border-radius: 5px; margin-bottom: 15px;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">取消</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">确认删除</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="script.js"></script>
</body>
</html>